<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workout Log</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #f2f2f7;
    margin: 0;
    padding: 16px;
}
h1 {
    text-align: center;
}
.card {
    background: white;
    padding: 12px;
    margin-bottom: 12px;
    border-radius: 10px;
}
input, button {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #ccc;
}
button {
    background: #007AFF;
    color: white;
    border: none;
    font-weight: bold;
}
.set {
    display: flex;
    gap: 6px;
}
.set input {
    flex: 1;
}
.small {
    font-size: 12px;
    color: gray;
}
.exercise-preview {
    font-size: 12px;
    color: #8e8e93;
    text-align: right;
    max-width: 140px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
</style>
</head>

<body>

<h1>Workout Log</h1>

<div class="card">
    <input id="workoutName" placeholder="Workout name">
    <button onclick="addWorkout()">Add Workout</button>
</div>

<div id="workouts"></div>

<script>
let workouts = JSON.parse(localStorage.getItem("workouts")) || [];
let expandedWorkout = null;
const workoutsDiv = document.getElementById("workouts");

function save() {
    localStorage.setItem("workouts", JSON.stringify(workouts));
    render();
}

function addWorkout() {
    const name = workoutName.value.trim();
    if (!name) return;

    workouts.unshift({
        date: new Date().toISOString().split("T")[0],
        name,
        exercises: []
    });
    workoutName.value = "";
    save();
}

function deleteWorkout(index) {
    if (!confirm("Delete this workout?")) return;
    workouts.splice(index, 1);
    expandedWorkout = null;
    save();
}

function addExercise(wIndex) {
    workouts[wIndex].exercises.push({
        name: "Exercise",
        sets: []
    });
    save();
}

function addSet(wIndex, eIndex) {
    workouts[wIndex].exercises[eIndex].sets.push({
        weight: "",
        reps: ""
    });
    save();
}

function toggleWorkout(index) {
    expandedWorkout = expandedWorkout === index ? null : index;
    render();
}

function render() {
    workoutsDiv.innerHTML = "";

    workouts.forEach((w, wi) => {
        const wDiv = document.createElement("div");
        wDiv.className = "card";
        const isOpen = expandedWorkout === wi;

        const exerciseNames = w.exercises
            .map(e => e.name)
            .filter(n => n.trim() !== "")
            .join(", ");

        wDiv.innerHTML = `
            <div onclick="toggleWorkout(${wi})"
                 style="display:flex;justify-content:space-between;align-items:center;cursor:pointer">
                <div>
                    <strong>${w.name}</strong><br>
                    <span class="small">${w.date}</span>
                </div>
                <div style="display:flex;align-items:center;gap:8px">
                    ${!isOpen && exerciseNames ? 
                        `<div class="exercise-preview">${exerciseNames}</div>` : ""}
                    <div style="font-size:18px;transform:rotate(${isOpen ? 180 : 0}deg)">
                        â–¼
                    </div>
                </div>
            </div>
        `;

        if (isOpen) {
            const controls = document.createElement("div");
            controls.innerHTML = `
                <label class="small">Workout Date</label>
                <input type="date" value="${w.date}"
                    onchange="workouts[${wi}].date=this.value;save()">

                <button onclick="addExercise(${wi})">Add Exercise</button>
                <button onclick="deleteWorkout(${wi})"
                        style="background:#ff3b30;margin-top:6px">
                    Delete Workout
                </button>
            `;
            wDiv.appendChild(controls);

            w.exercises.forEach((e, ei) => {
                const eDiv = document.createElement("div");
                eDiv.innerHTML = `
                    <input value="${e.name}"
                        onchange="workouts[${wi}].exercises[${ei}].name=this.value;save()">
                    <button onclick="addSet(${wi},${ei})">Add Set</button>
                `;

                e.sets.forEach((s, si) => {
                    const sDiv = document.createElement("div");
                    sDiv.className = "set";
                    sDiv.innerHTML = `
                        <input placeholder="Weight" value="${s.weight}"
                            onchange="workouts[${wi}].exercises[${ei}].sets[${si}].weight=this.value;save()">
                        <input placeholder="Reps" value="${s.reps}"
                            onchange="workouts[${wi}].exercises[${ei}].sets[${si}].reps=this.value;save()">
                    `;
                    eDiv.appendChild(sDiv);
                });

                wDiv.appendChild(eDiv);
            });
        }

        workoutsDiv.appendChild(wDiv);
    });
}

render();
</script>


</body>
</html>
